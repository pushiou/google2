<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
		
		<title>德健便當店-點餐系統</title>
		<style>
			.error{
				color:red;
			}
		</style>
  </head>
  <body>
	
    <div class="container">
        <h1 class="mt-5 text-center">德健便當店-點餐系統</h1>
		</div>
			
		</script>
			<!-- 表單返回頁，記得在表單加「 target='returnWin' 」 -->
			<iframe name="returnWin" style="display: none;" onload="this.onload=function(){window.location='ok.html'}"></iframe>
    	<form target='returnWin' role="form" action="https://docs.google.com/forms/u/0/d/e/1FAIpQLSdh-zYm1R5By7tAEJoV1EQW0SgPofPYeqf4fXru3G1do-C-Pg/formResponse"
			method="post" id="myForm">
        <div class="row">         
          <!--桌號-->              
          	<div class="col-sm-3">
            	<div class="form-group">
             	 <label>桌號<span class="text-danger">*</span></label>
									<select name="entry.1878337334" id="1878337334" value="" class="form-control" size="1">              
									<option value="">請選擇桌號</option>
									<option value="1號桌" selected>1號桌</option>  <!-- selected預設選擇 -->
									<option value="2號桌">2號桌</option>
									<option value="3號桌">3號桌</option>
									<option value="4號桌">4號桌</option>
									<option value="5號桌">5號桌</option>
									<option value="6號桌">6號桌</option>
              </select>
            </div>
		  </div>
		  <!-- 合計 -->
		  <div class="col-sm-3">
			  <label>合計</label>
			  <input type="text" class="form-control" name="total" id="total" value="" readonly><!-- readonly只能看不能輸入 防止亂填單亂填合計-->
		  </div>
        </div>
        <div class="row">
          <!--雞腿飯-90元-->              
          <div class="col-sm-3">
            <div class="form-group">
              <label><span class="title">雞腿飯-90元</span><span class="text-danger">(請填數量)</span></label>
              <input type="number" class="form-control amount" name="entry.1398653397" id="1398653397" value="0" min="0" onchange="calTotal();">
            </div>
          </div>          
          <!--雞排飯-80元-->              
          <div class="col-sm-3">
            <div class="form-group">
              <label><span class="title">雞排飯-80元</span><span class="text-danger">(請填數量)</span></label>
              <input type="number" class="form-control amount" name="entry.1895163720" id="1895163720" value="0" min="0" onchange="calTotal();">
            </div>
          </div>          
          <!--排骨飯-70元-->              
          <div class="col-sm-3">
            <div class="form-group">
              <label><span class="title">排骨飯-70元</span><span class="text-danger">(請填數量)</span></label>
              <input type="number" class="form-control amount" name="entry.893246" id="893246" value="0" min="0" onchange="calTotal();">
            </div>
          </div>          
          <!--招牌飯-60元-->              
          <div class="col-sm-3">
            <div class="form-group">
              <label><span class="title">招牌飯-60元</span><span class="text-danger">(請填數量)</span></label>
              <input type="number" class="form-control amount" name="entry.426357547" id="426357547" value="0" min="0" onchange="calTotal();">
                </div>
          </div> 

        </div> 
        
        <div class="row">
          <div class="col-sm-12">  
            <!-- 備註 -->
            <div class="form-group">
              <label class="control-label">備註</label>
              <textarea class="form-control" rows="4" id="1148703108" name="entry.1148703108">這是預設顯示</textarea>
            </div>
          </div>
        </div>

        <div class="text-center pb-3">
          <button type="submit" class="btn btn-primary">送出</button>
        </div>
      </form>



    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <!-- jQuery官網 Download Google CDN 找 -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
		<!-- 表單驗證 -->
		<script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.1/dist/jquery.validate.min.js"></script>
		<!-- 調用驗證方法 -->
		<script>
			// 一定要輸入桌號才能送出
			$(function(){
					$("#myForm").validate({
							submitHandler: function(form) {
									form.submit();
							},
							rules: {
									'entry.1878337334' : { //桌號
											required: true
									},
									// 雞腿飯 數量輸入不能低於0
									'entry.672544075' : { //雞腿飯
										digits:true ,
										min: 0
									},
									'entry.1895163720' : { // 雞排飯
												digits:true ,
												min: 0
									},
									'entry.entry.893246' : { // 排骨飯
												digits:true ,
												min: 0
									},
									'entry.426357547' : {  //招牌飯
												digits:true ,
												min: 0
									},
									'total': {  //合計
										required:true ,
									}
								},
							
							messages: {
									'entry.1878337334' : { //桌號
											required: "請輸入桌號"
									},
										// 雞腿飯 數量輸入不能低於0
									'entry.672544075' : { //雞腿飯
										digits:"請輸入正確數量" , 
										min: "請輸入正確數量"
									},
									'entry.1895163720' : { //雞排
										digits:"請輸入正確數量" , 
										min: "請輸入正確數量"
									},
									'entry.893246' : { //排骨
										digits:"請輸入正確數量" , 
										min: "請輸入正確數量"
									},
									'entry.426357547' : { //招牌
										digits:"請輸入正確數量" , 
										min: "請輸入正確數量"
									},
									'total': {  //合計
										required:"尚未點餐" ,
									}

							}
					});

			});

			function calTotal(){
            //document.getElementsByClassName("amount")[0].value //取數量
            //document.getElementsByClassName("title")[0].innerText //取標題
            var amounts = document.getElementsByClassName("amount");
            var titles = document.getElementsByClassName("title");
            var total = 0;
            for(var i=0; i < amounts.length; i++){
                var amount = document.getElementsByClassName("amount")[i].value; //數量
                var title = document.getElementsByClassName("title")[i].innerText; //取標題
                var subArr = title.split("-"); //字串分割
                var price = parseInt(subArr[1]); //報價  parseInt()將輸入的字串轉成整數
                total += amount * price; //合計=數量*報價
                // console.log(title); 要檢查哪裡有BUG 逐一輸入後檢視程式碼有沒有讀到(需輸入數量)
            }
			if(total === 0){
            	document.getElementById("total").value = ""; //價錢顯示在合計欄位上(合計的ID設定total)
			}else{
				document.getElementById("total").value = total;
			}
        }
		
	</script>
		 
	</body>
	
</html>